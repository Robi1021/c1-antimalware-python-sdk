BUILD_MAJOR ?=
BUILD_MINOR ?=
BUILD_PATCH ?=
BUILD_NUMBER ?=

all: build

build: clean
	pipenv sync --dev
	pipenv run python -m grpc_tools.protoc -Iamaas/grpc/protos=./protos \
		--python_out=./src/ \
		--pyi_out=./src/ \
		--grpc_python_out=./src/ \
		./protos/scan.proto
	pipenv run pipenv-setup sync
	pipenv run python setup.py sdist bdist_wheel --build-number $(BUILD_NUMBER)

upload:
	@echo "*** NOT IMPLEMENTED YET ***"

test:
	@echo "*** NOT IMPLEMENTED YET ***"

clean:
	@rm -rf dist build src/*.egg-info src/amaas/grpc/protos

.PHONY: all build upload test clean
